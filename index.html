<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="khmTM9yemLAQYvN3ZZHNZX_VKoL3l8fWSJHmD42Xii4" />
    
    <title>Segredo Urbano | A elite do entretenimento em todo o Brasil</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><path d=%22M50,30 C35,10 10,25 10,50 C10,75 50,95 50,95 C50,95 90,75 90,50 C90,25 65,10 50,30 Z%22 fill=%22red%22 /><text x=%2250%%22 y=%2262%%22 text-anchor=%22middle%22 font-family=%22serif%22 font-size=%2245%22 fill=%22white%22>S</text><text x=%2268%%22 y=%2272%%22 text-anchor=%22middle%22 font-family=%22serif%22 font-size=%2225%22 fill=%22black%22 font-weight=%22900%22>U</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Playfair+Display:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { background: #000; color: #fff; font-family: 'Montserrat', sans-serif; margin: 0; text-align: center; overflow-x: hidden; }
        header { border-bottom: 2px solid red; padding: 50px 20px 30px; background: linear-gradient(to bottom, #1a0000, #000); position: relative; }
        .loc-badge-header { display: inline-block; background: #222; border: 1px solid red; color: red; padding: 5px 15px; border-radius: 20px; font-size: 11px; margin-bottom: 35px; font-weight: bold; letter-spacing: 1px; }
        .logo-container { width: 130px; height: 130px; margin: 0 auto 20px; border-radius: 50%; border: 2px solid red; box-shadow: 0 0 30px rgba(255, 0, 0, 0.5); background: #000; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        #btn-adm-oculto { position: absolute; top: 0; right: 0; width: 80px; height: 80px; opacity: 0; z-index: 9999; border: none; background: transparent; display: none; }
        #btn-adm-vencimento { position: absolute; top: 0; left: 0; width: 80px; height: 80px; opacity: 0; z-index: 9999; border: none; background: transparent; display: none; }
        #aviso-18 { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, #220000 0%, #000 100%); z-index: 999999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; box-sizing: border-box; }
        #aviso-18 h1 { color: #d4af37; font-family: 'Playfair Display'; font-size: 42px; font-weight: 900; margin-bottom: 10px; }
        .tela { display: none; padding: 20px; }
        .ativa { display: block !important; }
        .btn { background: red; color: #fff; border: none; padding: 16px; width: 100%; max-width: 300px; margin: 12px auto; border-radius: 8px; cursor: pointer; font-weight: bold; text-transform: uppercase; display: block; font-family: 'Montserrat'; text-decoration: none; }
        .btn small { display: block; font-size: 10px; text-transform: none; font-weight: normal; margin-top: 3px; }
        .btn-whats { background: #25D366 !important; }
        #btn-suporte-fixo { position: fixed; bottom: 30px; left: 15px; background: #fff; color: #000; padding: 8px 15px; border-radius: 50px; text-decoration: none; font-weight: bold; font-size: 10px; border: 1px solid red; z-index: 1000; display: none; box-shadow: 0 0 10px rgba(0,0,0,0.8); }
        .cidade-txt { text-align: left; font-size: 10px; color: #ff0000; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .bairro-txt { color: #888; font-size: 10px; margin-left: 5px; text-transform: uppercase; font-weight: normal; }
        .card-pago { margin: 30px auto; max-width: 480px; text-align: left; padding: 0 10px; border-bottom: 1px solid #331111; padding-bottom: 30px; }
        .img-container { position: relative; border-radius: 15px; overflow: hidden; border: 1px solid #222; }
        /* AJUSTE PARA PRESERVAR PROPOR√á√ÉO VISUAL */
        .card-pago img { width: 100%; height: auto; min-height: 400px; object-fit: contain; background: #000; display: block; }
        .card-pago h2 { font-family: 'Playfair Display', serif; font-size: 30px; margin: 15px 0 5px; color: #fff; text-align: center; }
        .btn-seta { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.7); color: white; border: none; padding: 20px 12px; font-size: 24px; cursor: pointer; z-index: 20; border-radius: 5px; }
        .seta-esq { left: 5px; }
        .seta-dir { right: 5px; }
        .card-gratis { border-bottom: 1px solid #222; padding: 15px 0; max-width: 420px; margin: 0 auto; text-align: left; }
        .card-gratis-flex { display: flex; align-items: center; }
        .card-gratis .img-container { width: 121px; height: 121px; margin-right: 15px; flex-shrink: 0; }
        .card-gratis img { width: 121px; height: 121px; object-fit: cover; border-radius: 10px; }
        .card-gratis b { font-size: 18px; }
        .galeria-social { width: 100%; overflow: hidden; margin-top: 25px; background: rgba(255,0,0,0.03); padding: 15px 0; border-top: 1px solid #111; }
        .social-track { display: flex; width: max-content; animation: scroll-social 30s linear infinite; gap: 15px; padding-left: 15px; }
        .item-social { width: 70px; text-align: center; flex-shrink: 0; }
        .item-social img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 1px solid #333; }
        .item-social span { display: block; font-size: 8px; color: #888; text-transform: uppercase; margin-top: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        @keyframes scroll-social { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .badge-fotos { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6); color: #fff; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; z-index: 10; }
        #modal-galeria { display: none; position: fixed; z-index: 1000000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); }
        .btn-fechar-galeria { position: absolute; top: 20px; right: 25px; color: white; font-size: 50px; cursor: pointer; z-index: 1000005; font-weight: bold; }
        .modal-cont { position: relative; height: 100%; display: flex; align-items: center; justify-content: center; }
        .btn-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,0,0,0.7); color: white; border: none; font-size: 28px; padding: 18px; border-radius: 5px; z-index: 1000004; }
        input { background: #111; border: 1px solid #333; color: #fff; padding: 14px; width: 90%; margin: 8px 0; border-radius: 8px; font-family: 'Montserrat'; }
        #aviso-pix-central { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.95); border: 2px solid #25D366; padding: 25px; border-radius: 20px; z-index: 1000001; width: 80%; max-width: 300px; box-shadow: 0 0 50px rgba(37, 211, 102, 0.3); }
        .item-adm, .card-validade { background: #111; padding: 15px; border: 1px solid #333; margin-bottom: 12px; border-radius: 10px; text-align: left; }
        .badge-plano-adm { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-top: 5px; background: #333; color: #fff; }
        .plano-pago { background: gold !important; color: #000 !important; }
        .area-revisao { background: #0a0a0a; padding: 15px; border-radius: 8px; margin-top: 10px; display: none; border: 1px solid red; }
        .grade-fotos-adm { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .foto-revisao { position: relative; width: 65px; height: 85px; cursor: pointer; }
        .foto-revisao img { width: 100%; height: 100%; object-fit: cover; border-radius: 4px; border: 1px solid #444; }
        .btn-del-foto { position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 22px; height: 22px; border: 2px solid #000; font-size: 14px; cursor: pointer; font-weight: bold; z-index: 10; }
        .metric-card { background: #1a0000; border: 1px solid red; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; }
        .inp-pos { width: 45px !important; background: #000 !important; border: 1px solid red !important; color: #fff !important; padding: 4px !important; text-align: center !important; border-radius: 4px !important; font-weight: bold !important; display: inline-block !important; }
        .inp-cidade-adm { width: 80px !important; background: #222 !important; border: 1px solid #444 !important; color: #fff !important; padding: 4px !important; font-size: 10px !important; border-radius: 4px !important; margin-left: 5px !important; }
        .badge-cliques-zap { background: #25D366; color: #000; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 900; margin-left: 10px; }
        .btn-toggle-plano { background: #333; color: #fff; border: 1px solid #555; font-size: 9px; padding: 5px; border-radius: 4px; cursor: pointer; margin-top: 8px; text-transform: uppercase; font-weight: bold; width: 100%; }
        .btn-toggle-plano:hover { background: gold; color: #000; }
        .badge-vencido { color: #ff4444; font-weight: bold; }
        .badge-ok { color: #25D366; font-weight: bold; }
        #container-busca-cidade { display: none; padding: 15px; background: #000; }
        .caixa-busca-moderna { display: flex; max-width: 400px; margin: 0 auto; gap: 8px; }
        .inp-busca-txt { flex: 1; background: #111; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 25px; outline: none; font-size: 14px; transition: border-color 0.3s; }
        .btn-busca-lupa { background: red; border: none; border-radius: 50%; width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .seletor-cidade-adm { background: #000; color: red; border: 1px solid red; padding: 10px; border-radius: 8px; width: 100%; margin-bottom: 15px; font-weight: bold; }
        .busca-erro { border-color: red !important; box-shadow: 0 0 10px rgba(255,0,0,0.5); }
        #aviso-vazio { display: none; background: #1a0000; border: 1px dashed red; padding: 25px; border-radius: 12px; margin: 30px auto; max-width: 300px; }
        #aviso-vazio p { color: #ff0000; font-size: 14px; font-weight: bold; margin: 0; line-height: 1.4; }
    </style>
</head>
<body>

    <div id="aviso-18">
        <h1>AVISO</h1>
        <p>Conte√∫do para maiores de 18 anos</p>
        <button class="btn" onclick="fecharAviso18()">Entrar</button>
        <button class="btn" style="background:transparent; border: 1px solid #444; color: #666;" onclick="window.location.href='https://www.google.com'">Sair</button>
    </div>

    <div id="aviso-pix-central">
        <b style="color:#25D366; font-size:18px;">‚úì COPIADO!</b><br><br>
        <p style="font-size:14px; color:#fff; line-height:1.4; margin:0;">Pague o valor de <b id="valor-aviso" style="color:#25D366;"></b> no seu banco usando o <b>Pix Copia e Cola</b>.</p>
        <small style="display:block; margin-top:15px; color:#666;">Aguarde o redirecionamento...</small>
    </div>

    <a href="https://wa.me/5551981833377?text=Ol√° moderadores, preciso de ajuda." target="_blank" id="btn-suporte-fixo">‚óè SUPORTE</a>

    <header>
        <button id="btn-adm-vencimento" onclick="logAdmPrazos()"></button>
        <button id="btn-adm-oculto" onclick="logAdm()"></button>
        <div class="loc-badge-header" id="badge-local-topo">üìç EM TODO BRASIL</div>
        <div class="logo-container">
            <svg viewBox="0 0 100 100" width="100" height="100">
                <path d="M50,30 C35,10 10,25 10,50 C10,75 50,95 50,95 C50,95 90,75 90,50 C90,25 65,10 50,30 Z" fill="rgba(255,0,0,0.15)" />
                <text x="50%" y="62%" text-anchor="middle" font-family="'Playfair Display', serif" font-size="45" fill="white">S</text>
                <text x="68%" y="72%" text-anchor="middle" font-family="'Playfair Display', serif" font-size="25" fill="red" font-weight="900">U</text>
            </svg>
        </div>
        <b style="color:red; font-size:26px; text-transform:uppercase; letter-spacing:2px; font-family:'Playfair Display';">Segredo Urbano</b>
    </header>

    <div id="container-busca-cidade">
        <div class="caixa-busca-moderna">
            <input type="text" id="inp-filtro-cidade" class="inp-busca-txt" placeholder="Digite sua cidade..." onkeydown="if(event.key==='Enter'){ filtrarPorCidade(); this.blur(); }">
            <button class="btn-busca-lupa" onclick="filtrarPorCidade()">
                <svg width="18" height="18" fill="white" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            </button>
        </div>
    </div>

    <div id="modal-galeria">
        <div class="btn-fechar-galeria" onclick="fecharGaleria()">&times;</div>
        <button class="btn-nav" style="left:15px;" onclick="mudarFoto(-1)">&#10094;</button>
        <div class="modal-cont"><img id="img-ampliada" src="" style="max-width:95%; max-height:92vh;"></div>
        <button class="btn-nav" style="right:15px;" onclick="mudarFoto(1)">&#10095;</button>
    </div>

    <div id="menu" class="tela ativa">
        <button class="btn" onclick="filtrarPorCidade()">VER AN√öNCIOS</button>
        <button class="btn" style="background:#fff; color:#000" onclick="ir('planos')">ANUNCIAR AGORA</button>
        <div class="galeria-social" id="area-social" style="display:none;">
            <div class="social-track" id="track-social"></div>
        </div>
    </div>

    <div id="planos" class="tela">
        <h2 style="color:red; font-family:'Playfair Display';">ESCOLHA SEU DESTAQUE</h2>
        <button class="btn" onclick="p(30)">30 DIAS - R$ 59,90 <small>At√© 10 fotos</small></button>
        <button class="btn" onclick="p(15)">15 DIAS - R$ 39,90 <small>At√© 10 fotos</small></button>
        <button class="btn" onclick="p(7)">7 DIAS - R$ 19,90 <small>At√© 10 fotos</small></button>
        <button class="btn" onclick="p(0)" style="background:gray">PLANO GR√ÅTIS <small>At√© 3 fotos</small></button>
        <button class="btn" style="background:none; border:1px solid #333;" onclick="ir('menu')">VOLTAR</button>
    </div>

    <div id="cad" class="tela">
        <h3 style="font-family:'Playfair Display';">CADASTRO</h3>
        <p id="aviso-limite" style="color:red; font-size:11px; margin-bottom:10px;"></p>
        <input type="text" id="n" placeholder="Nome Art√≠stico">
        <input type="text" id="cid" placeholder="Cidade">
        <input type="text" id="bai" placeholder="Bairro (Obrigat√≥rio)">
        <input type="email" id="email_user" placeholder="Seu E-mail">
        <input type="text" id="w" placeholder="WhatsApp (ex: 51988887777)">
        <input type="file" id="f" accept="image/*" multiple onchange="loadFiles()">
        <div id="preview" style="display:flex; justify-content:center; flex-wrap:wrap; gap:8px; margin:15px;"></div>
        <button class="btn" onclick="enviar()">ENVIAR AN√öNCIO</button>
    </div>

    <div id="tela-pix" class="tela">
        <h2 style="color:red; font-family:'Playfair Display';">PAGAMENTO</h2>
        <div style="background:#111; padding:25px; border-radius:12px; border:1px dashed red; max-width:320px; margin: 0 auto;">
            <p style="font-size:13px; color:#aaa; margin-bottom:20px;">Copie a chave e pague no seu banco.</p>
            <b id="chave-txt" style="font-size:11px; word-break:break-all; color:#fff; background:#000; padding:10px; display:block; border-radius:5px;">7f0690c2-31b1-4d73-9af4-a88e83bcfabe</b>
            <button class="btn" id="btn-copia-pix" style="background:#fff; color:#000; margin-top:20px;" onclick="copiarPix()">COPIAR CHAVE PIX</button>
        </div>
    </div>

    <div id="vitrine" class="tela">
        <div id="aviso-vazio">
            <p id="txt-aviso-vazio"></p>
        </div>
        <div id="lv"></div>
        <button class="btn" onclick="ir('menu')">VOLTAR</button>
    </div>

    <div id="adm" class="tela">
        <h2 style="color:red;">PAINEL ADM</h2>
        <div class="metric-card"><span><b>BUSCAS REALIZADAS:</b></span><span id="display-cliques" style="font-size:24px; color:red; font-weight:900;">0</span></div>
        <select id="filtro-adm-cidade" class="seletor-cidade-adm" onchange="renderizarListasAdm()"><option value="todas">VER TODAS AS CIDADES</option></select>
        <h4 style="text-align:left; color:#888;">PARA APROVAR:</h4><div id="ap"></div>
        <hr style="border-color:#222; margin:20px 0;">
        <h4 style="text-align:left; color:#888;">ATIVOS:</h4><div id="aa"></div>
        <button class="btn" onclick="ir('menu')">SAIR</button>
    </div>

    <div id="tela-validade" class="tela">
        <h2 style="color:red; font-family:'Playfair Display';">CONTROLE DE PRAZOS</h2>
        <div class="metric-card" style="margin-bottom:10px;">
            <span><b>CIDADES ATIVAS:</b></span>
            <span id="qtd-cidades-prazos" style="font-size:24px; color:red; font-weight:900;">0</span>
        </div>
        <select id="filtro-prazos-cidade" class="seletor-cidade-adm" onchange="renderizarPrazos()">
            <option value="todas">VER TODAS AS CIDADES</option>
        </select>
        <div id="lista-prazos"></div>
        <button class="btn" onclick="ir('menu')">SAIR</button>
    </div>

    <script>
        const conf = { databaseURL: "https://segredo-urbano-a4d81-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(conf);
        const db = firebase.database();
        let imgs = []; let dias = 0; let fotosGaleria = []; let fotoIndex = 0; let telaAtual = 'menu';
        let bancoDeFotos = {}; let sliderIndices = {}; let bancoPlanos = {}; 
        let anunciosCache = []; let cidadesMapeadas = {}; 
        let cidadePostagemOriginal = "";

        const normalizarTxt = (txt) => txt ? txt.normalize('NFD').replace(/[\u0300-\u036f]/g, "").toLowerCase().trim() : "";

        function fecharAviso18() { document.getElementById('aviso-18').style.display = 'none'; ir('menu'); }

        function filtrarPorCidade(termoManual = "") {
            const input = document.getElementById('inp-filtro-cidade');
            const termoOriginal = (termoManual || input.value).trim();
            const termoBusca = normalizarTxt(termoOriginal);
            if(!termoBusca) {
                input.classList.add('busca-erro'); input.placeholder = "DIGITE UMA CIDADE!";
                setTimeout(() => input.classList.remove('busca-erro'), 2000); return false;
            }
            db.ref('cliques_vitrine').transaction((atual) => (atual || 0) + 1);
            input.value = termoOriginal.toUpperCase(); document.getElementById('badge-local-topo').innerText = "üìç " + termoOriginal.toUpperCase();
            ir('vitrine');
            const cards = document.querySelectorAll('.card-pago, .card-gratis');
            let encontrados = 0;
            cards.forEach(c => {
                const cidadeNoCard = normalizarTxt(c.getAttribute('data-cidade') || "");
                if(cidadeNoCard.includes(termoBusca)) { c.style.display = 'block'; encontrados++; } else { c.style.display = 'none'; }
            });
            const aviso = document.getElementById('aviso-vazio');
            if(encontrados === 0) {
                document.getElementById('txt-aviso-vazio').innerText = `Ainda n√£o temos an√∫ncios em ${termoOriginal.toUpperCase()}.`;
                aviso.style.display = 'block'; setTimeout(() => { input.value = ''; aviso.style.display = 'none'; }, 4000);
            } else { aviso.style.display = 'none'; }
            return true;
        }

        window.onpopstate = function() { if (document.getElementById('modal-galeria').style.display === 'block') { fecharGaleria(); } else if (telaAtual !== 'menu') { ir('menu', true); } };

        function ir(id, isBack = false) { 
            document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa')); document.getElementById(id).classList.add('ativa'); telaAtual = id;
            if (!isBack) history.pushState({page: id}, id);
            document.getElementById('inp-filtro-cidade').value = '';
            const barra = document.getElementById('container-busca-cidade');
            if(['menu', 'vitrine'].includes(id) && document.getElementById('aviso-18').style.display === 'none') { barra.style.display = 'block'; } else { barra.style.display = 'none'; }
            const isMenu = (id === 'menu'); document.getElementById('btn-suporte-fixo').style.display = isMenu ? 'block' : 'none';
            document.getElementById('btn-adm-oculto').style.display = isMenu ? 'block' : 'none';
            document.getElementById('btn-adm-vencimento').style.display = isMenu ? 'block' : 'none';
        }

        function trackZap(key) { db.ref('anuncios/' + key + '/cliquesZap').transaction((atual) => (atual || 0) + 1); }
        db.ref('cliques_vitrine').on('value', s => { document.getElementById('display-cliques').innerText = s.val() || 0; });

        function trocarFotoCard(key, dir) {
            const fotos = bancoDeFotos[key]; if (!fotos) return;
            if (sliderIndices[key] === undefined) sliderIndices[key] = 0;
            sliderIndices[key] += dir; if (sliderIndices[key] < 0) sliderIndices[key] = fotos.length - 1; if (sliderIndices[key] >= fotos.length) sliderIndices[key] = 0;
            document.getElementById('img-pago-' + key).src = fotos[sliderIndices[key]];
            document.getElementById('badge-pago-' + key).innerText = `üì∏ ${sliderIndices[key] + 1}/${fotos.length}`;
        }

        function p(d) { dias = d; imgs = []; document.getElementById('aviso-limite').innerText = `Limite: ${d > 0 ? '10' : '3'} fotos.`; ir('cad'); }

        // CORRE√á√ÉO DA IMAGEM DENTRO DO C√ìDIGO IMUT√ÅVEL
        async function loadFiles() {
            const files = Array.from(document.getElementById('f').files);
            document.getElementById('preview').innerHTML = 'Processando...';
            const promises = files.map(f => {
                return new Promise((resolve) => {
                    const r = new FileReader();
                    r.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const cv = document.createElement('canvas');
                            const ctx = cv.getContext('2d');
                            let w = img.width;
                            let h = img.height;
                            const max = 1100; // Mant√©m qualidade sem estourar o banco
                            if (w > h) { if (w > max) { h *= max / w; w = max; } }
                            else { if (h > max) { w *= max / h; h = max; } }
                            cv.width = w; cv.height = h;
                            ctx.drawImage(img, 0, 0, w, h);
                            resolve(cv.toDataURL('image/jpeg', 0.7));
                        };
                        img.src = e.target.result;
                    };
                    r.readAsDataURL(f);
                });
            });
            imgs = await Promise.all(promises); document.getElementById('preview').innerHTML = '';
            imgs.forEach(data => { document.getElementById('preview').innerHTML += `<img src="${data}" style="width:35px; height:45px; object-fit:cover; border-radius:4px;">`; });
        }

        function limparFormulario() {
            document.getElementById('n').value = ''; document.getElementById('cid').value = ''; document.getElementById('bai').value = ''; 
            document.getElementById('email_user').value = ''; document.getElementById('w').value = ''; document.getElementById('f').value = ''; 
            document.getElementById('preview').innerHTML = ''; document.getElementById('inp-filtro-cidade').value = ''; imgs = [];
        }

        async function enviar() {
            const n = document.getElementById('n').value.trim(); const c = document.getElementById('cid').value.trim(); 
            const b = document.getElementById('bai').value.trim(); const em = document.getElementById('email_user').value.trim(); 
            let w = document.getElementById('w').value.replace(/\D/g,''); cidadePostagemOriginal = c;
            const limite = (dias > 0) ? 10 : 3;
            if(imgs.length > limite) return alert(`Limite: ${limite} fotos.`);
            if(!n || !c || !b || !w || !em || imgs.length === 0) return alert("Por favor, preencha todos os campos!");
            if(w.length <= 11) w = "55" + w;
            const duplicata = anunciosCache.find(a => a.data.whats === w || a.data.email === em);
            if(duplicata) { if(dias > 0 || duplicata.data.plano === 0) { await db.ref('anuncios').child(duplicata.key).remove(); } }
            db.ref('anuncios').push({ nome:n, cidade:c, bairro:b, email:em, whats:w, fotos:imgs, plano:dias, status:'pendente', criadoEm: Date.now(), pos: 0, cliquesZap: 0 }).then(() => { 
                if(dias > 0) ir('tela-pix'); else { const cidTemp = cidadePostagemOriginal; limparFormulario(); filtrarPorCidade(cidTemp); }
            });
        }

        function copiarPix() { 
            navigator.clipboard.writeText("7f0690c2-31b1-4d73-9af4-a88e83bcfabe"); const btnCopia = document.getElementById('btn-copia-pix');
            btnCopia.innerText = "‚úì COPIADO!"; btnCopia.style.background = "#25D366"; btnCopia.style.color = "#000";
            let v = dias === 15 ? "R$ 39,90" : (dias === 30 ? "R$ 59,90" : "R$ 19,90");
            document.getElementById('valor-aviso').innerText = v; document.getElementById('aviso-pix-central').style.display = "block";
            setTimeout(() => { document.getElementById('aviso-pix-central').style.display = "none"; btnCopia.innerText = "COPIAR CHAVE PIX"; btnCopia.style.background = "#fff"; const cidTemp = cidadePostagemOriginal; limparFormulario(); filtrarPorCidade(cidTemp); }, 6000);
        }

        function abrirGaleria(key, idxManual) { 
            const lista = bancoDeFotos[key]; if (!lista) return;
            fotosGaleria = lista; fotoIndex = (idxManual !== undefined) ? idxManual : (sliderIndices[key] || 0); 
            const imgEl = document.getElementById('img-ampliada'); imgEl.src = fotosGaleria[fotoIndex]; 
            if (bancoPlanos[key] === 0) { imgEl.style.maxWidth = "60%"; imgEl.style.maxHeight = "60vh"; } else { imgEl.style.maxWidth = "95%"; imgEl.style.maxHeight = "92vh"; }
            document.getElementById('modal-galeria').style.display = 'block'; history.pushState({modal: 'galeria'}, 'galeria');
        }

        function fecharGaleria() { document.getElementById('modal-galeria').style.display = 'none'; }
        function mudarFoto(dir) { fotoIndex += dir; if(fotoIndex >= fotosGaleria.length) fotoIndex = 0; if(fotoIndex < 0) fotoIndex = fotosGaleria.length - 1; document.getElementById('img-ampliada').src = fotosGaleria[fotoIndex]; }
        
        function logAdm() { const s = prompt("Senha:"); if(btoa(s) === "MTkwNzgz") ir('adm'); }
        function logAdmPrazos() { const s = prompt("Senha:"); if(btoa(s) === "MTkwNzgz") { renderizarPrazos(); ir('tela-validade'); } }

        function toggleRev(key) { const d = document.getElementById('rev-'+key); d.style.display = d.style.display === 'block' ? 'none' : 'block'; }
        function removerFoto(key, idx) { db.ref('anuncios/'+key+'/fotos').once('value', s => { let fots = s.val(); fots.splice(idx, 1); db.ref('anuncios/'+key).update({ fotos: fots }); }); }
        function togglePlano(key, planoAtual) { let novoPlano = (planoAtual === 0) ? 7 : 0; db.ref('anuncios/' + key).update({ plano: novoPlano }); }

        function renderizarPrazos() {
            const container = document.getElementById('lista-prazos');
            const filtroRaw = document.getElementById('filtro-prazos-cidade').value;
            const filtroNorm = normalizarTxt(filtroRaw);
            container.innerHTML = ''; const agora = Date.now();
            anunciosCache.forEach(item => {
                const d = item.data; const key = item.key;
                const cidadeNorm = normalizarTxt(d.cidade);
                if(d.status === 'ativo' && (filtroRaw === 'todas' || cidadeNorm === filtroNorm)) {
                    const prazoDias = (d.plano > 0) ? d.plano : 30;
                    const diasRestantes = prazoDias - Math.floor((agora - (d.criadoEm || agora)) / 86400000);
                    const cor = diasRestantes > 0 ? 'badge-ok' : 'badge-vencido';
                    const isVencido = diasRestantes <= 0;
                    container.innerHTML += `<div class="card-validade"><b>${d.nome}</b> (${d.cidade})<br><small>${d.plano>0?'PLANO PAGO':'GR√ÅTIS'}</small> | <span class="${cor}">${!isVencido ? 'Restam ' + diasRestantes + ' dias' : 'VENCIDO'}</span><div style="float:right; display:flex; gap:5px; margin-top:5px;"><button onclick="window.open('https://wa.me/${d.whats}')" style="background:#25D366; border:none; padding:8px; border-radius:4px; font-weight:bold; cursor:pointer;">ZAP</button>${isVencido && d.plano > 0 ? `<button onclick="if(confirm('Tornar GR√ÅTIS?')){ db.ref('anuncios/${key}').update({plano:0, criadoEm: Date.now()}); }" style="background:#666; color:#fff; border:none; padding:8px; border-radius:4px; font-weight:bold; cursor:pointer;">GR√ÅTIS</button>` : ''}<button onclick="if(confirm('Excluir an√∫ncio?')){ db.ref('anuncios').child('${key}').remove(); }" style="background:red; border:none; padding:8px; border-radius:4px; font-weight:bold; cursor:pointer; color:#fff;">X</button></div></div>`;
                }
            });
        }

        function renderizarListasAdm() {
            const ap = document.getElementById('ap'); const aa = document.getElementById('aa');
            const filtroRaw = document.getElementById('filtro-adm-cidade').value; 
            const filtroBuscaNorm = normalizarTxt(filtroRaw); 
            ap.innerHTML = ''; aa.innerHTML = '';
            anunciosCache.forEach(item => {
                const d = item.data; const key = item.key;
                const cidadeItemNorm = normalizarTxt(d.cidade);
                if(d.status === 'pendente') {
                    let fotsRev = ''; d.fotos.forEach((f, idx) => { fotsRev += `<div class="foto-revisao"><img src="${f}" onclick="abrirGaleria('${key}', ${idx})"><button class="btn-del-foto" onclick="removerFoto('${key}', ${idx}); event.stopPropagation();">√ó</button></div>`; });
                    ap.innerHTML += `<div class="item-adm"><div><b>${d.nome}</b> (${d.cidade})<br><span class="badge-plano-adm ${d.plano > 0 ? 'plano-pago' : ''}">PLANO: ${d.plano > 0 ? d.plano : 'GR√ÅTIS'}</span> <button onclick="toggleRev('${key}')" style="float:right; background:red; color:white; border:none; padding:5px 10px; border-radius:4px;">REVISAR</button></div><div id="rev-${key}" class="area-revisao"><div class="grade-fotos-adm">${fotsRev}</div><div style="margin-top:15px; display:flex; gap:10px;"><button class="btn" style="margin:0; flex:1; background:green;" onclick="db.ref('anuncios').child('${key}').update({status:'ativo', criadoEm: Date.now()})">APROVAR</button><button class="btn" style="margin:0; flex:1; background:#444;" onclick="db.ref('anuncios').child('${key}').remove()">EXCLUIR</button></div></div></div>`;
                } else if(d.status === 'ativo' && (filtroRaw === 'todas' || cidadeItemNorm === filtroBuscaNorm)) {
                    aa.innerHTML += `<div class="item-adm"><div style="display:flex; align-items:center; gap:8px;"><img src="${d.fotos[0]}" style="width:35px; height:45px; object-fit:cover; border-radius:4px;"><div style="flex:1; font-size:11px;"><b>${d.nome}</b> (${d.bairro}) <span class="badge-cliques-zap">üì≤ ${d.cliquesZap || 0}</span><br>P:<input type="number" value="${d.pos || 0}" class="inp-pos" onchange="db.ref('anuncios/${key}').update({pos: parseInt(this.value)})"><input type="text" value="${d.cidade}" class="inp-cidade-adm" onchange="db.ref('anuncios/${key}').update({cidade: this.value})"></div><button onclick="db.ref('anuncios').child('${key}').remove()" style="background:#444; color:white; border:none; padding:8px; border-radius:4px;">X</button></div><button class="btn-toggle-plano" onclick="togglePlano('${key}', ${d.plano || 0})">${d.plano > 0 ? 'MUDAR P/ GR√ÅTIS' : 'DAR DESTAQUE (PAGO)'}</button></div>`;
                }
            });
        }

        db.ref('anuncios').on('value', s => {
            const lv = document.getElementById('lv'); lv.innerHTML = ''; const track = document.getElementById('track-social'); track.innerHTML = '';
            anunciosCache = []; let mapaTemporario = {}; let ativos = [];
            s.forEach(i => {
                const d = i.val(); anunciosCache.push({key: i.key, data: d}); 
                if(d.cidade && d.status === 'ativo') { 
                    const norm = normalizarTxt(d.cidade); 
                    if(!mapaTemporario[norm]) mapaTemporario[norm] = d.cidade.trim().toUpperCase(); 
                }
                bancoDeFotos[i.key] = d.fotos; bancoPlanos[i.key] = d.plano; 
                if(d.status === 'ativo') ativos.push({key: i.key, ...d});
            });
            if(ativos.length > 0) { document.getElementById('area-social').style.display = 'block'; let aleatorios = [...ativos].sort(() => 0.5 - Math.random()).slice(0, 12); [...aleatorios, ...aleatorios].forEach(m => { track.innerHTML += `<div class="item-social"><img src="${m.fotos[0]}"><span>${m.cidade}</span></div>`; }); }
            const seletorAdm = document.getElementById('filtro-adm-cidade'); 
            const seletorPrazos = document.getElementById('filtro-prazos-cidade');
            const vAtAdm = seletorAdm.value; const vAtPrz = seletorPrazos.value;
            const cidadesOrdenadas = Object.values(mapaTemporario).sort();
            document.getElementById('qtd-cidades-prazos').innerText = cidadesOrdenadas.length;
            let optionsHtml = '<option value="todas">VER TODAS AS CIDADES</option>';
            cidadesOrdenadas.forEach(nome => { optionsHtml += `<option value="${nome}">${nome}</option>`; });
            seletorAdm.innerHTML = optionsHtml; seletorPrazos.innerHTML = optionsHtml;
            seletorAdm.value = vAtAdm; seletorPrazos.value = vAtPrz;
            ativos.sort((a, b) => { const pA = parseInt(a.pos || 0); const pB = parseInt(b.pos || 0); if (pA === 0 && pB === 0) return b.criadoEm - a.criadoEm; if (pA === 0) return -1; if (pB === 0) return 1; return pA - pB; });
            ativos.forEach(d => {
                const waLink = `https://wa.me/${d.whats}?text=${encodeURIComponent('Ol√° '+d.nome+', te vi no Segredo Urbano!')}`;
                const bairroHtml = d.bairro ? `<span class="bairro-txt">‚Ä¢ ${d.bairro}</span>` : "";
                if(d.plano > 0) lv.innerHTML += `<div class="card-pago" data-cidade="${d.cidade}"><div class="cidade-txt">üìç ${d.cidade} ${bairroHtml}</div><div class="img-container"><img src="${d.fotos[0]}" id="img-pago-${d.key}" onclick="abrirGaleria('${d.key}')"><div class="badge-fotos" id="badge-pago-${d.key}">üì∏ 1/${d.fotos.length}</div>${d.fotos.length > 1 ? `<button class="btn-seta seta-esq" onclick="event.stopPropagation(); trocarFotoCard('${d.key}', -1)">&#10094;</button><button class="btn-seta seta-dir" onclick="event.stopPropagation(); trocarFotoCard('${d.key}', 1)">&#10095;</button>` : ''}</div><h2>${d.nome}</h2><a href="${waLink}" target="_blank" onclick="trackZap('${d.key}')" class="btn btn-whats">WhatsApp</a></div>`;
                else lv.innerHTML += `<div class="card-gratis" data-cidade="${d.cidade}"><div class="cidade-txt">üìç ${d.cidade} ${bairroHtml}</div><div class="card-gratis-flex"><div class="img-container" style="position:relative;" onclick="abrirGaleria('${d.key}', 0)"><img src="${d.fotos[0]}"><div class="badge-fotos" style="font-size:8px; padding:2px 5px; top:3px; right:3px;">üì∏ ${d.fotos.length}</div></div><b style="flex:1;">${d.nome}</b><a href="${waLink}" target="_blank" onclick="trackZap('${d.key}')" style="color:#25D366; text-decoration:none; border:1px solid #25D366; padding:6px 10px; border-radius:6px; font-size:11px;">WHATS</a></div></div>`;
            });
            renderizarListasAdm();
            if(telaAtual === 'tela-validade') renderizarPrazos();
        });
    </script>
</body>
</html>
